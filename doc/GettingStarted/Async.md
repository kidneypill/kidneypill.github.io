---
title: Async
layout: default
parent: Getting Started
nav_order: 9
---

## ë¹„ë™ê¸° (Async)  
  
	
Vaporì˜ ëª‡ëª‡ APIë“¤ì´ `Future` ìë£Œí˜•ì„ ê¸°ëŒ€í•˜ê±°ë‚˜ ë°˜í™˜í•œë‹¤ëŠ”ê±¸ ëˆˆì¹˜ ì±„ì…¨ì„ê²ë‹ˆë‹¤. futureì— ëŒ€í•´ ì²˜ìŒ ë“¤ìœ¼ì‹ ë‹¤ë©´ ì¡°ê¸ˆ í—·ê°ˆë¦´ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë‹ˆ ê±±ì •í•  ê±´ ì—†ìŠµë‹ˆë‹¤.  
  
ì´ ê°€ì´ë“œëŠ” Asyncì˜ ë¹ ë¥¸ í™œìš©ì„ ìœ„í•œ ë„ì…ë¶€ì…ë‹ˆë‹¤. ì¢€ë” ìì„¸í•œ ì •ë³´ëŠ” [Async â†’ Overview](/doc/Async/Overview)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.  
  
	
---
## Futures
âš ï¸`Future`ëŠ” **ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‘ìš©**í•˜ê¸° ë•Œë¬¸ì—, ê·¸ ê°’ì„ ë‹¤ë£¨ê¸° ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ **í´ë¡œì ¸**ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.  
  
Swiftì˜ ì˜µì…”ë„ì²˜ëŸ¼, futureì—ë„ **map** ë˜ëŠ” **flatMap**ì´ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

---
### Map
` .map(to:_:)` ë©”ì†Œë“œë¥¼ í†µí•´ **future ê°’**ì„ **ë˜ë‹¤ë¥¸ ê°’**ìœ¼ë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
  
âš ï¸ì œê³µëœ í´ë¡œì ¸ëŠ” ```Future```ì˜ ë°ì´í„°ê°€ ìœ íš¨í•´ì§€ë©´ ë‹¨ í•œë²ˆ í˜¸ì¶œë©ë‹ˆë‹¤.  
```swift
/// ì–´ë– í•œ APIë¡œë¶€í„° future stringì„ ë°˜í™˜ë°›ì•˜ë‹¤ê³  ê°€ì •í•©ì‹œë‹¤
let futureString: Future<String> = ...

/// future stringì„ integerë¡œ ë§¤í•‘í•©ë‹ˆë‹¤.
let futureInt = futureString.map(to: Int.self) { string in
    print(string) // ì´ê²ƒì´ ì‹¤ì œ Stringì…ë‹ˆë‹¤
    return Int(string) ?? 0
}

/// ì´ì œ future integerê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.
print(futureInt) // Future<Int>
```

---
### Flat Map
`.flatMap(to:_:)` ë©”ì†Œë“œë¥¼ í†µí•´ **future ê°’**ì„ **ë˜ë‹¤ë¥¸ future ê°’**ìœ¼ë¡œ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¦„ì´ "flat" mapì¸ ì´ìœ ëŠ” ì¤‘ì²©(nested feature)ì„ í”¼í•˜ê²Œ í•´ì£¼ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. (e.g., `Future<Future<T>>`). ì—¬ëŸ¬ë¶„ì˜ futureë¥¼ í‰í‰í•˜ê²Œ í•´ì¤€ë‹¤ëŠ” ë§ì´ì£ .  

```swift
/// ì–´ë– í•œ APIë¡œë¶€í„° future stringì„ ë°˜í™˜ë°›ì•˜ë‹¤ê³  ê°€ì •í•©ì‹œë‹¤
let futureString: Future<String> = ...

/// HTTP í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„±í–ˆë‹¤ê³  ê°€ì •í•©ì‹œë‹¤
let client: Client = ... 

/// future stringì„ future responseë¡œ í”Œë«ë§¤í•‘í•©ë‹ˆë‹¤
let futureResponse = futureString.flatMap(to: Response.self) { string in
    return client.get(string) // Future<Response>
}

/// ì´ì œ future responseê°€ ë˜ì—ˆìŠµë‹ˆë‹¤
print(futureResponse) // Future<Response>
```
  
â„¹ï¸ìœ„ ì˜ˆì‹œì—ì„œ `.map(to:_:)`ë¥¼ ì¼ë‹¤ë©´  ê·¸ ê²°ê³¼ëŠ” `Future<Future<Response>>`ì´ì—ˆì„ê±°ì—ìš”. ë”ì°í•´ë¼!

---
## ì—°ì‡„ (Chaining)
futureì— ëŒ€í•œ ë³€í˜•ì— ìˆì–´ì„œ ê°€ì¥ ì¢‹ì€ê±´ ë°”ë¡œ ì—°ì‡„ê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ”ê±°ì£ . ë§ì€ ë³€í™˜ê³¼ ë¶€ê°€ì ì¸ ì‘ì—…ë“¤ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
  
ìœ„ì— ë‚˜ì™”ë˜ ì˜ˆì‹œë¥¼ ê°€ì§€ê³  ì—°ì‡„ì˜ ì´ì ì„ ì–´ë–»ê²Œ í™œìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë´…ì‹œë‹¤.  
```swift
/// ì–´ë– í•œ APIë¡œë¶€í„° future stringì„ ë°˜í™˜ë°›ì•˜ë‹¤ê³  ê°€ì •í•©ì‹œë‹¤
let futureString: Future<String> = ...

/// HTTP clientë¥¼ ìƒì„±í–ˆë‹¤ê³  ê°€ì •í•©ì‹œë‹¤
let client: Client = ... 

/// stringì„ urlë¡œ ë³€í™˜í•œ ë’¤, ê·¸ê±¸ responseë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
/// Future<URL>ìœ¼ë¡œ ë§¤í•‘ëœ ë’¤ ë°”ë¡œ Future<Response>ë¡œ í”Œë«ë§¤í•‘ë˜ëŠ” ê²ƒì— ì£¼ëª©í•˜ì„¸ìš”.
let futureResponse = futureString.map(to: URL.self) { string in
    guard let url = URL(string: string) else {
        throw Abort(.badRequest, reason: "Invalid URL string: \(string)")
    }
    return url
}.flatMap(to: Response.self) { url in
    return client.get(url)
}

print(futureResponse) // Future<Response>
```

ê°€ì¥ ì²˜ìŒ mapì„ í˜¸ì¶œí•˜ëŠ” ê³³ì—ì„œ `Future<URL>`ì´ ìƒì„±ë˜ì—ˆë‹¤ê°€, ë°”ë¡œ `Future<Response>`ë¡œ í”Œë«ë§¤í•‘ë©ë‹ˆë‹¤.  
  
ğŸ“–mapê³¼ flat-map í´ë¡œì ¸ ë‚´ë¶€ì—ì„œ ì—ëŸ¬ë¥¼ `throw`í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. futureê°€ ì‹¤íŒ¨í•˜ë©´ì„œ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¬ ë•Œ í•´ë‹¹ ì½”ë“œê°€ ì‹¤í–‰ë ê²ë‹ˆë‹¤.  

---
## Worker
Vaporì—ì„œ `on: Worker` íŒ¨ëŸ¬ë¯¸í„°ë¥¼ ê°€ì§„ ë©”ì†Œë“œë¥¼ ë³´ì…¨ì„ ê²ë‹ˆë‹¤. ë¹„ë™ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•˜ë©´ì„œ `EventLoop`ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ê°€ í•„ìš”í•œ ë©”ì†Œë“œì—ì„œ ì£¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.  

ğŸ“–`EventLoop`ì— ëŒ€í•œ ì •ë³´ëŠ” [Async â†’ Overview](/doc/Async/Overview)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”
  
ì—¬ëŸ¬ë¶„ì´ Vaporì—ì„œ ë§ˆì£¼ì¹  ê°€ì¥ í”í•œ `Worker`ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
* `Application`
* `Request`
* `Response`

```swift
/// Requestì™€ ì–´ë– í•œ ViewRenderê°€ ìˆë‹¤ê³  ê°€ì •í•©ì‹œë‹¤
let req: Request = ...
let view: ViewRenderer = ...

/// Requestë¥¼ workerë¡œ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ë·°ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.
/// ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ í˜„ì¬ event loopì—ì„œ ë¹„ë™ê¸° ì‘ì—…ì´ ì¼ì–´ë‚˜ë„ë¡ í•©ë‹ˆë‹¤.
///
/// ì‹œê·¸ë‹ˆì²˜:
/// func render(_: String, on: Worker)
view.render("home.html", on: req)
```

---
### ğŸ¤ì´ˆì‹¬ì
ğŸ“–**ë¹„ë™ê¸°(Asynchronous)**ê°€ ë­”ê°€ìš”?  
  
> ë¹„ë™ê¸°(Asynchronous), ë™ê¸°(Synchronous)ì— ëŒ€í•œ ê¸°ë³¸ì ì¸ ê°œë…ì€ ë§¤ìš° ê°„ë‹¨í•©ë‹ˆë‹¤.  
> ë™ê¸°ëŠ” ë°˜ë“œì‹œ ì–´ë– í•œ í•˜ë‚˜ì˜ ì‘ì—…ì„ ì™„ì „íˆ ì²˜ë¦¬í•œ ë’¤ ë‹¤ë¥¸ ì‘ì—…ì— ì°©ìˆ˜í•˜ëŠ” ê²ƒì´ê³   
> ë¹„ë™ê¸°ëŠ” ì–´ë– í•œ í•˜ë‚˜ì˜ ì‘ì—…ì„ ì²˜ë¦¬í•˜ë©´ì„œ ë‹¤ë¥¸ ì‘ì—…ì„ ë™ì‹œì— ì²˜ë¦¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

> ì–´ë– í•œ ë°˜í™˜ê°’ì„ ê°€ì§„ ë©”ì†Œë“œê°€ ë™ê¸°ì ì´ë¼ë©´, ë©”ì†Œë“œê°€ ê²°ê³¼ë¬¼ì„ ë°˜í™˜í•œ ë’¤ì— ë‹¤ë¥¸ ì‘ì—…ì´ ì§„í–‰ë©ë‹ˆë‹¤.  
> ì–´ë– í•œ ë°˜í™˜ê°’ì„ ê°€ì§„ ë©”ì†Œë“œê°€ ë¹„ë™ê¸°ì ì´ë¼ë©´, ë©”ì†Œë“œê°€ ê²°ê³¼ë¬¼ì„ ì•„ì§ ë°˜í™˜í•˜ì§€ ì•Šì•˜ìŒì—ë„ ë‹¤ë¥¸ ì‘ì—…ì´ ì§„í–‰ë©ë‹ˆë‹¤.  
  
> FutureëŠ” ì´ëŸ¬í•œ ë¹„ë™ê¸° ì‘ì—…ì˜ ê°œë…ì— ì°©ì•ˆí•œ Vaporì˜ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ë³´í†µ ì‹œê°„ì´ ë§ì´ ì†Œìš”ë˜ëŠ” ì‘ì—…ì— ë¹„ë™ê¸° ë°©ì‹ì´ ì ìš©ë˜ëŠ”ë°, ì˜ˆë¥¼ ë“¤ë©´ ë°ì´í„°ë² ì´ìŠ¤ì— ì¿¼ë¦¬ë¥¼ í•˜ëŠ” ì‘ì—…ì´ ìˆê² ìŠµë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ ë’¤ ê·¸ ì •ë³´ë¥¼ í™ˆí˜ì´ì§€ì— ë¿Œë¦¬ëŠ” ì½”ë“œê°€ ìˆë‹¤ê³  í•´ë´…ì‹œë‹¤.  

```swift
struct Data {
	...
	var description: String
	...
}

// ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ë¬´ì–¸ê°€ë¥¼ ê°€ì ¸ì™€ dataì— ë‹´ìŠµë‹ˆë‹¤.
// ë‹¨, ì‘ì—…ì— ì˜¤ëœ ì‹œê°„ì´ ì†Œìš”ë©ë‹ˆë‹¤.
let data = Database.fetch( something )

// ê°€ì ¸ì˜¨ dataì— ëŒ€í•œ ì„¤ëª…(description)ì„ ì¶œë ¥í•©ë‹ˆë‹¤.
print(data.description)

// ì´ëŸ¬í•œ ì½”ë“œëŠ” ë³´í†µ ì˜¤ë¥˜ë¥¼ ì¼ìœ¼í‚¤ê±°ë‚˜ ì˜ˆìƒê³¼ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ì¶œë ¥í•˜ê²Œ ë©ë‹ˆë‹¤.
// dataì— ì•„ì§ ì •ë³´ê°€ ì œëŒ€ë¡œ ë‹´ê¸°ì§€ ì•Šì€ ìƒí™©ì—ì„œ dataì˜ descriptionì— ì ‘ê·¼í•˜ë ¤ í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
```
```swift
// ë”°ë¼ì„œ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…ì€ ë¹„ë™ê¸°ì ì´ë¼ëŠ” íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬ í´ë¡œì € í˜•íƒœë¡œ í‘œí˜„í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
Database.fetch( something ) { data in
	let data = data
	print(data.description)
	// ì´ì œ dataì˜ descriptionì´ ì œëŒ€ë¡œ ì¶œë ¥ë ê²ë‹ˆë‹¤.
}
```
  
	
ğŸ“–**map**ê³¼ **flatMap**ì„ ì“°ëŠ” ì´ìœ ê°€ ë­ì£ ?  

> FutureëŠ” ë°°ì—´ì´ê³  (ì •í™•í•˜ê²ŒëŠ” [SwiftNIO][swift-nio] í”„ë ˆì„ì›Œí¬ì˜ `EventLoopFuture`ì˜ typealiasì…ë‹ˆë‹¤.), ë°°ì—´ì˜ êµ¬ì„±ìš”ì†Œë¥¼ ê°ê° ë‹¤ë¥¸ êµ¬ì„±ìš”ì†Œë¡œ ë³€í™˜í•˜ëŠ” ë©”ì†Œë“œê°€ ë°”ë¡œ map ë˜ëŠ” flatMapì…ë‹ˆë‹¤. ë”°ë¼ì„œ mapê³¼ flatMapì´ ì‚¬ìš©ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
  
ğŸ“–Worker ê°œë…ì´ ì˜ ì™€ë‹¿ì§€ ì•ŠìŠµë‹ˆë‹¤.

> [Async â†’ Overview](/doc/Async/Overview#Worker)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.  

---

[swift-nio]: <https://github.com/apple/swift-nio>